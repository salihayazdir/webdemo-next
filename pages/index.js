import { useEffect } from 'react'
import Head from 'next/head'
import Image from 'next/image'
import axios from 'axios'
import { useNavigation } from '../lib/NavContext'

export default function Home({data}) {
  
  const {navigation, setNavigation} = useNavigation();

  const categories = data.data.map(category => {
    const pages = category.attributes.pages.data.map(page => {
      return {
        id: page.id,
        title: page.attributes.title,
        slug: page.attributes.slug,
      }
    })
    
    return {
      id: category.id,
      name: category.attributes.category_name,
      slug: category.attributes.category_slug,
      pages: pages
    }
  })

  useEffect(() => {
    setNavigation(categories)
  }, [])
  
  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div className='flex max-w-20' >
        asd
      </div>
    </div>
  )
}

export async function getStaticProps() {
  
  try {
    console.log('asd')
    const token = process.env.NEXT_PUBLIC_STRAPI_TOKEN;
    axios.defaults.headers.common = {'Authorization': `bearer ${token}`}

    const res = await axios.get(`${process.env.NEXT_PUBLIC_STRAPI_URL}/categories`, {
      params: { populate: '*' }
    });

    console.log(res.data)
    const data = await res.data

    return { props: { data } }

  } catch (error) {
    console.error(error);
    return { props: "Error" }
  }

}